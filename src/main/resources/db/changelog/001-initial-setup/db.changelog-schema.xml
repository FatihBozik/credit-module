<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="05-02-2025 21:06:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <sql>
            create table users
            (
                username varchar(20) not null,
                password varchar(20) not null,
                enabled  boolean     not null default true,
                constraint pk_users primary key (username)
            );
        </sql>
    </changeSet>

    <changeSet id="05-02-2025 21:07:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>
        <sql>
            create table roles
            (
                id       int generated by default as identity primary key,
                username varchar(20) not null,
                role     varchar(20) not null,
                foreign key (username) references users (username),
                constraint uni_username_role unique (role, username)
            );
        </sql>
    </changeSet>

    <changeSet id="05-02-2025 21:53:0" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="customers"/>
            </not>
        </preConditions>
        <sql>
            create table customers
            (
                id                int generated by default as identity primary key,
                name              text           not null,
                surname           text           not null,
                credit_limit      numeric(15, 2) not null,
                used_credit_limit numeric(15, 2) not null,
                username          text           not null unique,
                constraint fk_customers_users foreign key (username)
                    references users (username) on delete cascade
            );
        </sql>
    </changeSet>

    <changeSet id="05-02-2025 21:55:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="loans"/>
            </not>
        </preConditions>
        <sql>
            create table loans
            (
                id                    int generated by default as identity primary key,
                customer_id           int            not null,
                loan_amount           numeric(15, 2) not null,
                number_of_installment int            not null,
                create_date           date           not null,
                is_paid               boolean        not null,
                constraint fk_loans_customers foreign key (customer_id)
                    references customers (id) on delete cascade
            );
        </sql>
    </changeSet>

    <changeSet id="05-02-2025 22:05:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="loan_installments"/>
            </not>
        </preConditions>
        <sql>
            create table loan_installments
            (
                id           int generated by default as identity primary key,
                loan_id      int            not null,
                amount       numeric(15, 2) not null,
                paid_amount  numeric(15, 2) not null,
                due_date     date           not null,
                payment_date date,
                is_paid      boolean        not null,
                constraint fk_installments_loans foreign key (loan_id)
                    references loans (id) on delete cascade
            );
        </sql>
    </changeSet>
</databaseChangeLog>
